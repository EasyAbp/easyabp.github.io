(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{678:function(t,e,s){"use strict";s.r(e);var a=s(73),n=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"abp-eventbus-cap"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#abp-eventbus-cap"}},[t._v("#")]),t._v(" Abp.EventBus.CAP")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://abp.io",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/badge/dynamic/xml?style=flat-square&color=yellow&label=abp&query=%2F%2FProject%2FPropertyGroup%2FAbpVersion&url=https%3A%2F%2Fraw.githubusercontent.com%2FEasyAbp%2FAbp.EventBus.CAP%2Fmaster%2FDirectory.Build.props",alt:"ABP version"}}),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://cap.dotnetcore.xyz",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/badge/dynamic/xml?style=flat-square&color=yellow&label=cap&query=%2F%2FProject%2FPropertyGroup%2FCapPackageVersion&url=https%3A%2F%2Fraw.githubusercontent.com%2FEasyAbp%2FAbp.EventBus.CAP%2Fmaster%2FDirectory.Build.props",alt:"CAP version"}}),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://www.nuget.org/packages/EasyAbp.Abp.EventBus.CAP",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/nuget/v/EasyAbp.Abp.EventBus.CAP.svg?style=flat-square",alt:"NuGet"}}),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://www.nuget.org/packages/EasyAbp.Abp.EventBus.CAP",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/nuget/dt/EasyAbp.Abp.EventBus.CAP.svg?style=flat-square",alt:"NuGet Download"}}),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://discord.gg/S6QaezrCRq",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://badgen.net/discord/online-members/S6QaezrCRq?label=Discord",alt:"Discord online"}}),e("OutboundLink")],1),t._v(" "),e("a",{attrs:{href:"https://www.github.com/EasyAbp/Abp.EventBus.CAP",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://img.shields.io/github/stars/EasyAbp/Abp.EventBus.CAP?style=social",alt:"GitHub stars"}}),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("ABP vNext framework "),e("a",{attrs:{href:"https://github.com/dotnetcore/CAP",target:"_blank",rel:"noopener noreferrer"}},[t._v("CAP"),e("OutboundLink")],1),t._v(" EventBus module.")]),t._v(" "),e("h2",{attrs:{id:"installation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[t._v("#")]),t._v(" Installation")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("Install the following NuGet packages. ("),e("a",{attrs:{href:"https://github.com/EasyAbp/EasyAbpGuide/blob/master/docs/How-To.md#add-nuget-packages",target:"_blank",rel:"noopener noreferrer"}},[t._v("see how"),e("OutboundLink")],1),t._v(")")]),t._v(" "),e("ul",[e("li",[t._v("EasyAbp.Abp.EventBus.CAP")]),t._v(" "),e("li",[t._v("EasyAbp.Abp.EventBus.Dashboard (if you need the CAP dashboard)")]),t._v(" "),e("li",[t._v("EasyAbp.Abp.EventBus.EntityFrameworkCore (if you need CAP transactional outbox)")]),t._v(" "),e("li",[t._v("EasyAbp.Abp.EventBus.MongoDB (coming soon...)")]),t._v(" "),e("li",[t._v("DotNetCore.CAP.SqlServer (or other DB providers if you are using EF Core)")]),t._v(" "),e("li",[t._v("DotNetCore.CAP.MongoDB (if you are using MongoDB)")]),t._v(" "),e("li",[t._v("DotNetCore.CAP.RabbitMQ (or other MQ providers)")])])]),t._v(" "),e("li",[e("p",[t._v("Add "),e("code",[t._v("DependsOn(typeof(AbpEventBusCapXxxModule))")]),t._v(" attribute to configure the module dependencies. ("),e("a",{attrs:{href:"https://github.com/EasyAbp/EasyAbpGuide/blob/master/docs/How-To.md#add-module-dependencies",target:"_blank",rel:"noopener noreferrer"}},[t._v("see how"),e("OutboundLink")],1),t._v(")")])]),t._v(" "),e("li",[e("p",[t._v("Configure the CAP.")]),t._v(" "),e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token return-type class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ConfigureServices")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServiceConfigurationContext")]),t._v(" context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" configuration "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Services"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetConfiguration")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddCapEventBus")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("capOptions "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// If you are using EF, you need to add:")]),t._v("\n        options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetCapDbConnectionString")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("configuration"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ConnectionStrings:Default"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token generic-method"}},[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UseEntityFramework")]),e("span",{pre:!0,attrs:{class:"token generic class-name"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("MyDbContext"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// CAP has multiple MQ implementations, e.g. RabbitMQ:")]),t._v("\n        options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UseRabbitMQ")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// We provide permission named "CapDashboard.Manage" for authorization.')]),t._v("\n        options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UseAbpDashboard")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),e("h2",{attrs:{id:"usage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[t._v("#")]),t._v(" Usage")]),t._v(" "),e("p",[t._v("See the "),e("a",{attrs:{href:"https://docs.abp.io/en/abp/latest/Distributed-Event-Bus",target:"_blank",rel:"noopener noreferrer"}},[t._v("ABP distributed event bus document"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("h2",{attrs:{id:"how-do-we-integrate-cap"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-do-we-integrate-cap"}},[t._v("#")]),t._v(" How Do We Integrate CAP?")]),t._v(" "),e("p",[t._v("After ABP 5.0 released, the distributed event bus was redesigned. See: https://github.com/abpframework/abp/issues/6126")]),t._v(" "),e("div",{staticClass:"language-c# extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// ABP 5.0\nTask PublishAsync<TEvent>(TEvent eventData, bool onUnitOfWorkComplete = true, bool useOutbox = true);\n\n// ABP 4.0\nTask PublishAsync<TEvent>(TEvent eventData);\n")])])]),e("p",[t._v("Before ABP 5.0, when you invoke PublishAsync, the bus will push the event to MQ at once.")]),t._v(" "),e("p",[t._v("As you can see, after ABP 5.0, events are sent using outbox on UOW complete by default. CAP has a built-in transactional outbox, so we can implement it easily.")]),t._v(" "),e("p",[t._v("If you install the "),e("code",[t._v("EasyAbp.Abp.EventBus.EntityFrameworkCore")]),t._v(" module, events are published with CAP's transactional outbox. Otherwise, they are published on UOW completed. See the "),e("a",{attrs:{href:"https://github.com/EasyAbp/Abp.EventBus.CAP/blob/master/src/EasyAbp.Abp.EventBus.CAP/CapDistributedEventBus.cs",target:"_blank",rel:"noopener noreferrer"}},[t._v("CapDistributedEventBus"),e("OutboundLink")],1),t._v(" for more information.")]),t._v(" "),e("p",[t._v("But there are also some "),e("a",{attrs:{href:"https://github.com/abpframework/abp/issues/6126#issuecomment-841888235",target:"_blank",rel:"noopener noreferrer"}},[t._v("problems"),e("OutboundLink")],1),t._v(" with CAP in ABP. In short, an ABP app could have more than one DB connection string, but CAP can only have one, this cannot be solved at present. So if there is not any DB connection string of the current UOW is equal to CAP's, events will be published after the UOW is completed.")]),t._v(" "),e("blockquote",[e("p",[t._v("Now we have a better solution: https://github.com/EasyAbp/Abp.EventBus.Boxes.Dtm")])])])}),[],!1,null,null,null);e.default=n.exports}}]);